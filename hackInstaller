#!/bin/bash

# variables
hackLocation="https://raw.githubusercontent.com/myshy13/hackProject/refs/heads/main/hack" # url to the hack script: https://raw.githubusercontent.com/myshy13/hackProject/refs/heads/main/hack
updaterLocation="https://raw.githubusercontent.com/myshy13/hackProject/refs/heads/main/hackInstaller"
UninstallerLocation="https://raw.githubusercontent.com/myshy13/hackProject/refs/heads/main/hackUninstaller"

# check for dependencies
dependencies=("curl" "nmap" "arp" "ping" "dig")
for dep in "${dependencies[@]}"; do
    if ! command -v "$dep" &> /dev/null; then
        echo "E: Dependency '$dep' is not installed. Please install it and try again."
        exit 1
    fi
done

# remove all current installed instances
echo "Checking for existing installations..."
sudo -v
if [ -n "$hackFile" ]; then
echo "IRemoving existing hack installation..."
    sudo rm -f "$hackFile" 
    else
        echo "Info: No existing hack installation found."
fi

if [ ! -n "$(which hackUpdater)" ]; then
    read -p "Would you like to install the hack updater? [y/n]: " install_updater
    if [ "$install_updater" = "y" ] || [ "$install_updater" = "Y" ]; then
        echo "I: Installing Updater script."
        sudo touch /usr/local/bin/hackUpdater
        echo $(curl -fsSl $(updaterLocation)) > /usr/local/bin/hackUpdater
        sudo chmod +x /usr/local/bin/hackUpdater

        echo "I: Installing Uninstallation script."
        sudo touch /usr/local/bin/hackUninstaller
        echo $(curl -fsSl $(UninstallerLocation)) > /usr/local/bin/hackUninstaller
        sudo chmod +x /usr/local/bin/hackUninstaller
    fi
fi

# install new version
if [[ "$hackLocation" =~ ^https?:// ]]; then
    echo "I: Downloading hack from $hackLocation..."
    # download via curl into the target path (requires sudo to write)
    if ! sudo curl -fsSL "$hackLocation" -o /usr/local/bin/hack; then
        echo "E: Failed to download $hackLocation"
        exit 1
    fi
else
    # local file path
    if ! sudo cp "$hackLocation" /usr/local/bin/hack; then
        echo "E: Failed to copy $hackLocation"
        exit 1
    fi
fi

# ensure executable
sudo chmod +x /usr/local/bin/hack
sudo chmod +x /usr/local/bin/hackUpdater
sudo chmod +x /usr/local/bin/hackUninstaller

read -p "#Would you like to restart your terminal now to apply changes? (y/n): " restart_terminal
if [ "$restart_terminal" = "y" ] || [ "$restart_terminal" = "Y" ]; then
    source ~/.bash_profile 2>/dev/null || source ~/.zshrc 2>/dev/null
    clear
    hack -h
fi